{"version":3,"file":"index.es.js","sources":["../src/Persistence.ts"],"sourcesContent":["import { Plugin, StateValueAtRoot, PluginCallbacks, State } from '@hookstate/core';\r\n\r\nconst PluginID = Symbol('LocalPersistence');\r\n\r\n// tslint:disable-next-line: function-name\r\nexport function Persistence(localStorageKey: string): (() => Plugin) {\r\n    return () => ({\r\n        id: PluginID,\r\n        init: (state: State<StateValueAtRoot>) => {\r\n            const persisted = localStorage.getItem(localStorageKey);\r\n            if (persisted !== null) {\r\n                const result = JSON.parse(persisted);\r\n                state.set(result);\r\n            } else if (!state.promised && !!!state.error) {\r\n                localStorage.setItem(localStorageKey, JSON.stringify(state.value))\r\n            }\r\n            return {\r\n                onSet: (p) => {\r\n                    if ('state' in p) {\r\n                        localStorage.setItem(localStorageKey, JSON.stringify(p.state));\r\n                    } else {\r\n                        localStorage.removeItem(localStorageKey)\r\n                    }\r\n                }\r\n            } as PluginCallbacks\r\n        }\r\n    })\r\n}\r\n"],"names":[],"mappings":"AAEA,IAAM,QAAQ,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAC;AAE5C;AACM,SAAU,WAAW,CAAC,eAAuB,EAAA;IAC/C,OAAO,YAAA,EAAM,QAAC;AACV,QAAA,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B,EAAA;YACjC,IAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YACxD,IAAI,SAAS,KAAK,IAAI,EAAE;gBACpB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;AACrC,gBAAA,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACrB,aAAA;iBAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE;AAC1C,gBAAA,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;AACrE,aAAA;YACD,OAAO;gBACH,KAAK,EAAE,UAAC,CAAC,EAAA;oBACL,IAAI,OAAO,IAAI,CAAC,EAAE;AACd,wBAAA,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAClE,qBAAA;AAAM,yBAAA;AACH,wBAAA,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,CAAA;AAC3C,qBAAA;iBACJ;aACe,CAAA;SACvB;KACJ,EAAC,EAAA,CAAA;AACN;;;;"}